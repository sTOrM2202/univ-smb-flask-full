#######Cr√©ation et configuration de la DB #######

USE identity;

CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  firstname VARCHAR(50) NOT NULL,
  lastname VARCHAR(50) NOT NULL,
  birthdate DATE NOT NULL
) ENGINE=InnoDB;


CREATE TABLE auth (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  token VARCHAR(255) NOT NULL,
  expiration DATETIME NOT NULL,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) ENGINE=InnoDB;

USE config_generator;

CREATE TABLE web_servers (
  id INT NOT NULL AUTO_INCREMENT,
  name VARCHAR(50) NOT NULL,
  ip_address VARCHAR(50) NOT NULL,
  port INT NOT NULL,
  document_root VARCHAR(255) NOT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB;

CREATE TABLE load_balancers (
  id INT NOT NULL AUTO_INCREMENT,
  name VARCHAR(50) NOT NULL,
  ip_address VARCHAR(50) NOT NULL,
  port INT NOT NULL,
  web_server_id INT NOT NULL,
  PRIMARY KEY (id),
  FOREIGN KEY (web_server_id) REFERENCES web_servers(id)
) ENGINE=InnoDB;

CREATE TABLE reverse_proxies (
  id INT NOT NULL AUTO_INCREMENT,
  name VARCHAR(50) NOT NULL,
  ip_address VARCHAR(50) NOT NULL,
  port INT NOT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB;

ALTER TABLE load_balancers
ADD CONSTRAINT fk_web_servers
FOREIGN KEY (web_server_id) REFERENCES web_servers(id);

CREATE USER 'louis'@localhost IDENTIFIED BY 'louis';
GRANT ALL PRIVILEGES ON *.* TO 'louis'@'localhost';
FLUSH PRIVILEGES;


